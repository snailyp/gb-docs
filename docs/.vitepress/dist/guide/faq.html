<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å¸¸è§é—®é¢˜ â“ | Gemini Balance</title>
    <meta name="description" content="Gemini Balance æŒ‡å—">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.DFTx90Kk.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Yv9tMCdR.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CDm2W-g2.js">
    <link rel="modulepreload" href="/assets/chunks/framework.Dh1jimFm.js">
    <link rel="modulepreload" href="/assets/guide_faq.md.DcpZCSKB.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Gemini Balance</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>é¦–é¡µ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/introduction.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>æŒ‡å—</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/snailyp/gemini-balance" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/snailyp/gemini-balance" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>ä½¿ç”¨æŒ‡å—</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/introduction.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>é¡¹ç›®ä»‹ç»</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/environment.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ç¯å¢ƒå˜é‡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>å®‰è£…éƒ¨ç½²</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/faq.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>å¸¸è§é—®é¢˜</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/acknowledgements.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ç‰¹åˆ«æ„Ÿè°¢</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/supportme.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>æ”¯æŒæˆ‘</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/guide/contactme.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>è”ç³»æˆ‘</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _guide_faq" data-v-39a288b8><div><h1 id="å¸¸è§é—®é¢˜-â“" tabindex="-1">å¸¸è§é—®é¢˜ â“ <a class="header-anchor" href="#å¸¸è§é—®é¢˜-â“" aria-label="Permalink to &quot;å¸¸è§é—®é¢˜ â“&quot;">â€‹</a></h1><div class="tip custom-block"><p class="custom-block-title">ğŸ’¡ å¦‚æœä¸‹é¢é—®é¢˜éƒ½ä¸æ˜¯ï¼Œè¯·æä¾›æ›´å¤šä¿¡æ¯ä»¥ä¾¿æˆ‘ä»¬æ›´å¥½åœ°å¸®åŠ©æ‚¨ï¼š</p><p>è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶<strong>åŠ¡å¿…</strong>è´´å‡ºç›¸å…³çš„æŠ¥é”™æ—¥å¿—ï¼ˆå°¤å…¶æ˜¯huggingfaceçš„æ—¥å¿—ï¼‰ã€‚</p></div><h2 id="_1-ä¸ºä»€ä¹ˆè¾“å…¥äº†æ­£ç¡®çš„auth-token-è¿˜æ˜¯ä¼šè·³è½¬åˆ°ç™»å½•é¡µ-ğŸ¤”" tabindex="-1">1. ä¸ºä»€ä¹ˆè¾“å…¥äº†æ­£ç¡®çš„AUTH_TOKENï¼Œè¿˜æ˜¯ä¼šè·³è½¬åˆ°ç™»å½•é¡µï¼Ÿ ğŸ¤” <a class="header-anchor" href="#_1-ä¸ºä»€ä¹ˆè¾“å…¥äº†æ­£ç¡®çš„auth-token-è¿˜æ˜¯ä¼šè·³è½¬åˆ°ç™»å½•é¡µ-ğŸ¤”" aria-label="Permalink to &quot;1. ä¸ºä»€ä¹ˆè¾“å…¥äº†æ­£ç¡®çš„AUTH_TOKENï¼Œè¿˜æ˜¯ä¼šè·³è½¬åˆ°ç™»å½•é¡µï¼Ÿ ğŸ¤”&quot;">â€‹</a></h2><p>ä¸è¦åœ¨huggingfaceçš„å†…åµŒé¡µé¢è¾“å…¥AUTH_TOKENï¼Œæ­£ç¡®åšæ³•æ˜¯å…ˆæ‹·è´å‡ºåµŒå…¥é¡µé¢çš„urlï¼Œåœ¨æµè§ˆå™¨ä¸Šè®¿é—®ï¼Œå†è¾“å…¥AUTH_TOKENå°±å¯ä»¥è¿›å…¥åˆ°ç®¡ç†é¡µäº†ã€‚</p><h2 id="_2-ä¸ºä»€ä¹ˆæˆ‘æ˜¯åœ¨æµè§ˆå™¨è®¿é—®çš„url-è¾“å…¥äº†auth-tokenè¿˜æ˜¯è¿›ä¸åˆ°ç®¡ç†é¡µ-ğŸ”’" tabindex="-1">2. ä¸ºä»€ä¹ˆæˆ‘æ˜¯åœ¨æµè§ˆå™¨è®¿é—®çš„urlï¼Œè¾“å…¥äº†auth_tokenè¿˜æ˜¯è¿›ä¸åˆ°ç®¡ç†é¡µï¼Ÿ ğŸ”’ <a class="header-anchor" href="#_2-ä¸ºä»€ä¹ˆæˆ‘æ˜¯åœ¨æµè§ˆå™¨è®¿é—®çš„url-è¾“å…¥äº†auth-tokenè¿˜æ˜¯è¿›ä¸åˆ°ç®¡ç†é¡µ-ğŸ”’" aria-label="Permalink to &quot;2. ä¸ºä»€ä¹ˆæˆ‘æ˜¯åœ¨æµè§ˆå™¨è®¿é—®çš„urlï¼Œè¾“å…¥äº†auth_tokenè¿˜æ˜¯è¿›ä¸åˆ°ç®¡ç†é¡µï¼Ÿ ğŸ”’&quot;">â€‹</a></h2><p>å› ä¸ºå®é™…çš„AUTH_TOKENåœ¨é¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±å·²ç»ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œåé¢ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥å»ºè®®åœ¨é¡¹ç›®åˆå§‹åŒ–ä¹‹å‰å°±è¦è®¾ç½®å¥½AUTH_TOKENã€‚</p><p>ä¸¤ç§æ–¹æ³•è¿›å…¥åå°ï¼š</p><ul><li>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªå€¼å°è¯•è¿›å…¥åå°ï¼ŒALLOWED_TOKENSåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå€¼æˆ–<code>your_token_1</code>,è¿›å…¥åå°åå†ä¿®æ”¹æˆè‡ªå·±æƒ³è¦è®¾ç½®çš„å€¼ï¼Œæœ€åä¸€å®šè¦ä¿å­˜é…ç½®ï¼Œæ‰ä¼šç”Ÿæ•ˆã€‚</li><li>ç”¨æ•°æ®åº“å®¢æˆ·ç«¯å·¥å…·ï¼ˆæ¯”å¦‚navicatï¼‰è¿æ¥åˆ°æ•°æ®åº“ï¼Œå‚çœ‹t_settingsè¡¨ä¸­AUTH_TOKENçš„å€¼ï¼Œç”¨è¯¥å€¼è¿›å…¥åå°ã€‚</li></ul><h2 id="_3-ä¸ºä»€ä¹ˆæˆ‘çš„ç”»å›¾ç”¨ä¸äº†-ğŸ¨" tabindex="-1">3. ä¸ºä»€ä¹ˆæˆ‘çš„ç”»å›¾ç”¨ä¸äº†ï¼Ÿ ğŸ¨ <a class="header-anchor" href="#_3-ä¸ºä»€ä¹ˆæˆ‘çš„ç”»å›¾ç”¨ä¸äº†-ğŸ¨" aria-label="Permalink to &quot;3. ä¸ºä»€ä¹ˆæˆ‘çš„ç”»å›¾ç”¨ä¸äº†ï¼Ÿ ğŸ¨&quot;">â€‹</a></h2><p>æ£€æŸ¥ä¸€ä¸‹å›¾åºŠæ˜¯å¦å·²ç»é…ç½®ï¼Œå¦‚æœé…ç½®äº†ï¼Œæ£€æŸ¥ä¸€ä¸‹UPLOAD_PROVIDERæ˜¯å¦å’Œä½ çš„keyåŒ¹é…ã€‚</p><h2 id="_4-ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹äº†é…ç½®ä¸ç”Ÿæ•ˆ-ğŸ”„" tabindex="-1">4. ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹äº†é…ç½®ä¸ç”Ÿæ•ˆï¼Ÿ ğŸ”„ <a class="header-anchor" href="#_4-ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹äº†é…ç½®ä¸ç”Ÿæ•ˆ-ğŸ”„" aria-label="Permalink to &quot;4. ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹äº†é…ç½®ä¸ç”Ÿæ•ˆï¼Ÿ ğŸ”„&quot;">â€‹</a></h2><p>ä¿®æ”¹é…ç½®ä¹‹åä¸€å®šéœ€è¦ä¿å­˜æ‰ä¼šç”Ÿæ•ˆã€‚</p><h2 id="_5-ä¹‹å‰åœ¨huggingfaceè¿˜æ˜¯å¥½å¥½çš„-æ›´æ–°ä¹‹åä¸€ç›´building-æ€ä¹ˆåŠ-ğŸ—ï¸" tabindex="-1">5. ä¹‹å‰åœ¨huggingfaceè¿˜æ˜¯å¥½å¥½çš„ï¼Œæ›´æ–°ä¹‹åä¸€ç›´building æ€ä¹ˆåŠï¼Ÿ ğŸ—ï¸ <a class="header-anchor" href="#_5-ä¹‹å‰åœ¨huggingfaceè¿˜æ˜¯å¥½å¥½çš„-æ›´æ–°ä¹‹åä¸€ç›´building-æ€ä¹ˆåŠ-ğŸ—ï¸" aria-label="Permalink to &quot;5. ä¹‹å‰åœ¨huggingfaceè¿˜æ˜¯å¥½å¥½çš„ï¼Œæ›´æ–°ä¹‹åä¸€ç›´building æ€ä¹ˆåŠï¼Ÿ ğŸ—ï¸&quot;">â€‹</a></h2><p>å¯èƒ½æ˜¯è§¦å‘äº†huggingfaceé£æ§äº†ï¼Œå»ºè®®é‡æ–°å¤åˆ¶ç©ºé—´ï¼Œç„¶åä¿®æ”¹spaceçš„åå­—ï¼Œå°½é‡ä¸è¦å’Œå…¶ä»–äººç›¸åŒã€‚ å¤‡ç”¨æ–¹æ¡ˆå°±æ˜¯æ¢å…¶ä»–å¹³å°ï¼Œæ¯”å¦‚renderæˆ–è€…claw cloudã€‚</p><h2 id="_6-ä¸æƒ³ä½¿ç”¨huggingfaceçš„ip-æœ‰ä»€ä¹ˆåŠæ³•å—-ğŸŒ" tabindex="-1">6. ä¸æƒ³ä½¿ç”¨huggingfaceçš„ipï¼Œæœ‰ä»€ä¹ˆåŠæ³•å—ï¼Ÿ ğŸŒ <a class="header-anchor" href="#_6-ä¸æƒ³ä½¿ç”¨huggingfaceçš„ip-æœ‰ä»€ä¹ˆåŠæ³•å—-ğŸŒ" aria-label="Permalink to &quot;6. ä¸æƒ³ä½¿ç”¨huggingfaceçš„ipï¼Œæœ‰ä»€ä¹ˆåŠæ³•å—ï¼Ÿ ğŸŒ&quot;">â€‹</a></h2><p>BASE_URLå¯ä»¥è®¾ç½®æˆä»£ç†åœ°å€ï¼šæ¯”å¦‚å¯ä»¥è‡ªå»ºgeminiä»£ç†ï¼Œä»¥denoä¸ºä¾‹ï¼šBASE_URL=<code>https://ä½ çš„denoä»£ç†åœ°å€/v1beta</code> è¿™é‡Œæä¾›ä¸€ä¸ªdenoç‰ˆæœ¬çš„ä»£ç ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡cloudflare workeræ­å»ºï¼Œæˆ–è€…ä½¿ç”¨cloudflare ai gatewayã€‚ä¹Ÿå¯ç”¨bbbæ­å»ºå¥½çš„ä»£ç†<code>https://api-proxy.me/gemini/v1beta</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// proxy_server.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { serve } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://deno.land/std/http/server.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * ç›®æ ‡ API æœåŠ¡å™¨çš„ URL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * æ‰€æœ‰ä¼ å…¥çš„è¯·æ±‚å°†è¢«è½¬å‘åˆ°è¿™ä¸ªåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TARGET_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://generativelanguage.googleapis.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å¤„ç†ä»£ç†è¯·æ±‚çš„æ ¸å¿ƒå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> - ä¼ å…¥çš„ HTTP è¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> è¿”å›ä»ç›®æ ‡æœåŠ¡å™¨è·å–çš„å“åº”æˆ–é”™è¯¯å“åº”</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. è§£æåŸå§‹è¯·æ±‚çš„ URLï¼Œè·å–è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.url);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.search; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// e.g., &quot;/v1beta/models?key=...&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. æ„å»ºè¦è¯·æ±‚çš„ç›®æ ‡ URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> targetUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TARGET_URL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[ä»£ç†è¯·æ±‚] ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">targetUrl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. å¤åˆ¶åŸå§‹è¯·æ±‚çš„ Headers</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    æ³¨æ„ï¼šHost å¤´é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼Œfetch ä¼šè‡ªåŠ¨å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    å¦‚æœç›®æ ‡æœåŠ¡å™¨éœ€è¦ç‰¹å®šçš„ Host å¤´ï¼Œå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.headers);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. åˆ›å»ºä¸€ä¸ªæ–°çš„ Request å¯¹è±¡ç”¨äºè½¬å‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> proxyRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(targetUrl, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      method: req.method,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers: headers,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å¦‚æœåŸå§‹è¯·æ±‚æœ‰ bodyï¼Œå…‹éš†å®ƒå¹¶ä¼ é€’ç»™ä»£ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // æ³¨æ„ï¼šreq.body åªèƒ½è¢«è¯»å–ä¸€æ¬¡ï¼Œæ‰€ä»¥éœ€è¦ clone()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      body: req.body </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().body </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // å…è®¸ fetch è‡ªåŠ¨å¤„ç†é‡å®šå‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      redirect: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;follow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. ä½¿ç”¨ fetch API å°†è¯·æ±‚å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(proxyRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 6. æ„å»ºè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    ç›´æ¥å°†ç›®æ ‡æœåŠ¡å™¨çš„å“åº”ä½“ã€çŠ¶æ€ç ã€çŠ¶æ€æ–‡æœ¬å’Œå¤´ä¿¡æ¯ä¼ é€’è¿‡æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> proxyResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: response.status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      statusText: response.statusText,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers: response.headers, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤åˆ¶ç›®æ ‡æœåŠ¡å™¨çš„å“åº”å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 7. æ·»åŠ  CORS (è·¨æºèµ„æºå…±äº«) å¤´éƒ¨ï¼Œå…è®¸å‰ç«¯ JavaScript è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    è¿™å¯¹äºåœ¨æµè§ˆå™¨ä¸­ç›´æ¥è°ƒç”¨æ­¤ä»£ç†å¾ˆæœ‰ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    æ³¨æ„ï¼šç›®æ ‡æœåŠ¡å™¨å¯èƒ½å·²ç»è®¾ç½®äº†éƒ¨åˆ† CORS å¤´ï¼Œè¿™é‡Œä¼šè¦†ç›–æˆ–æ·»åŠ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxyResponse.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Access-Control-Allow-Origin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å…è®¸ä»»ä½•æ¥æº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxyResponse.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Access-Control-Allow-Methods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å…è®¸çš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxyResponse.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Access-Control-Allow-Headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Type, Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å…è®¸çš„è¯·æ±‚å¤´</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[ä»£ç†å“åº”] ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">statusText</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} for ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">targetUrl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> proxyResponse;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 8. å¦‚æœåœ¨ä»£ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè®°å½•é”™è¯¯å¹¶è¿”å› 500 å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ä»£ç†è¯·æ±‚å‡ºé”™:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`ä»£ç†é”™è¯¯: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å¤„ç† CORS é¢„æ£€è¯·æ±‚ (OPTIONS æ–¹æ³•)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * æµè§ˆå™¨åœ¨å‘é€å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨çš„è·¨åŸŸè¯·æ±‚ï¼ˆå¦‚ POST, PUT, DELETE æˆ–å¸¦æœ‰è‡ªå®šä¹‰å¤´çš„ GETï¼‰å‰ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * ä¼šå…ˆå‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚æ¥è¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥å®é™…è¯·æ±‚ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> - ä¼ å…¥çš„ HTTP è¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> å¦‚æœæ˜¯ OPTIONS è¯·æ±‚ï¼Œè¿”å›å¸¦æœ‰ CORS å…è®¸å¤´éƒ¨çš„ 204 å“åº”ï¼›å¦åˆ™è¿”å› nullã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleCORS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (req.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[CORS é¢„æ£€] ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯¹äº OPTIONS è¯·æ±‚ï¼Œå“åº”ä½“é€šå¸¸ä¸º null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">204</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;No Content&quot; çŠ¶æ€ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Access-Control-Allow-Origin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¿…é¡»ä¸å®é™…è¯·æ±‚çš„å“åº”å¤´ä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Access-Control-Allow-Methods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å…è®¸çš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Access-Control-Allow-Headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Type, Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å…è®¸çš„è¯·æ±‚å¤´</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Access-Control-Max-Age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;86400&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é¢„æ£€è¯·æ±‚ç»“æœçš„ç¼“å­˜æ—¶é—´ (ç§’)ï¼Œä¾‹å¦‚ 24 å°æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¦‚æœä¸æ˜¯ OPTIONS è¯·æ±‚ï¼Œåˆ™è¿”å› nullï¼Œè®©ä¸»å¤„ç†å‡½æ•°ç»§ç»­å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * è¯·æ±‚çš„ä¸»å…¥å£å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å…ˆæ£€æŸ¥æ˜¯å¦ä¸º CORS é¢„æ£€è¯·æ±‚ï¼Œå¦‚æœæ˜¯åˆ™å¤„ç†ï¼›å¦åˆ™äº¤ç»™æ ¸å¿ƒä»£ç†å‡½æ•°å¤„ç†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> - ä¼ å…¥çš„ HTTP è¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> è¿”å›æœ€ç»ˆçš„ HTTP å“åº”</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. å¤„ç† CORS é¢„æ£€è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> corsResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleCORS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (corsResponse) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> corsResponse; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¦‚æœæ˜¯é¢„æ£€è¯·æ±‚ï¼Œç›´æ¥è¿”å›å¤„ç†ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. å¤„ç†æ­£å¸¸çš„ä»£ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * è·å–æœ¬æœºåœ¨å±€åŸŸç½‘ä¸­çš„ IPv4 åœ°å€åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> è¿”å›ä¸€ä¸ªåŒ…å«æœ¬æœºæœ‰æ•ˆ IPv4 åœ°å€çš„å­—ç¬¦ä¸²æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getLocalIPs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ips</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> interfaces</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Deno.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">networkInterfaces</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–æ‰€æœ‰ç½‘ç»œæ¥å£ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> iface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> interfaces) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ç­›é€‰æ¡ä»¶:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - éå†…éƒ¨æ¥å£ (æ’é™¤ loopback å¦‚ 127.0.0.1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - æœ‰åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - åœ°å€æ—æ˜¯ IPv4</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - ä¸æ˜¯ APIPA åœ°å€ (169.254.x.x)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">iface.internal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        iface.address </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        iface.family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;IPv4&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">iface.address.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;169.254.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ips.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(iface.address);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä½ å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ  IPv6 (iface.family === &quot;IPv6&quot;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœè·å–æ¥å£ä¿¡æ¯å¤±è´¥ï¼Œæ‰“å°é”™è¯¯ï¼Œä½†ç¨‹åºç»§ç»­è¿è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;âš ï¸ æ— æ³•è·å–ç½‘ç»œæ¥å£ä¿¡æ¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error.message);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ips;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// --- ğŸš€ æœåŠ¡å™¨å¯åŠ¨ ---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. è·å–ç«¯å£å·ï¼Œä¼˜å…ˆä»ç¯å¢ƒå˜é‡ PORT è·å–ï¼Œå¦åˆ™é»˜è®¤ä¸º 8080</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Deno.env.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PORT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. æ‰“å°å¯åŠ¨ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--------------------------------------&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`ğŸ¯ ä»£ç†ç›®æ ‡: ${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TARGET_URL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`ğŸš€ Deno ä»£ç†æœåŠ¡å™¨æ­£åœ¨å¯åŠ¨...`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`ğŸ‘‚ ç›‘å¬ç«¯å£: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--------------------------------------&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;   ğŸ”— å¯è®¿é—®åœ°å€:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`      - æœ¬åœ°è®¿é—®: http://localhost:${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`      - å›ç¯åœ°å€: http://127.0.0.1:${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. è·å–å¹¶æ‰“å°å±€åŸŸç½‘ IP åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> localIPs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getLocalIPs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (localIPs.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;      - ç½‘ç»œè®¿é—® (å…¶ä»–è®¾å¤‡å¯èƒ½ä½¿ç”¨):&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  localIPs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`        - http://${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;        (è¯·ç¡®ä¿é˜²ç«å¢™å…è®¸ TCP ç«¯å£ &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; çš„å…¥ç«™è¿æ¥)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;      âš ï¸ æœªèƒ½è‡ªåŠ¨æ£€æµ‹åˆ°æœ‰æ•ˆçš„æœ¬åœ°ç½‘ç»œ IP åœ°å€ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;         å¦‚æœéœ€è¦ä»å…¶ä»–è®¾å¤‡è®¿é—®ï¼Œè¯·æ‰‹åŠ¨æŸ¥è¯¢æœ¬æœº IP å¹¶ç¡®ä¿é˜²ç«å¢™è®¾ç½®æ­£ç¡®ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--------------------------------------&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;â³ ç­‰å¾…è¯·æ±‚...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4. å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼Œä½¿ç”¨ handleRequest å‡½æ•°å¤„ç†æ‰€æœ‰è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handleRequest, { port });</span></span></code></pre></div><h2 id="_7-é‡æ–°éƒ¨ç½²æ˜¯ä¸æ˜¯å¯ä»¥æŠŠé‚£äº›å¤šä½™çš„é…ç½®åˆ æ‰äº†-âœ…" tabindex="-1">7. é‡æ–°éƒ¨ç½²æ˜¯ä¸æ˜¯å¯ä»¥æŠŠé‚£äº›å¤šä½™çš„é…ç½®åˆ æ‰äº†ï¼Ÿ âœ… <a class="header-anchor" href="#_7-é‡æ–°éƒ¨ç½²æ˜¯ä¸æ˜¯å¯ä»¥æŠŠé‚£äº›å¤šä½™çš„é…ç½®åˆ æ‰äº†-âœ…" aria-label="Permalink to &quot;7. é‡æ–°éƒ¨ç½²æ˜¯ä¸æ˜¯å¯ä»¥æŠŠé‚£äº›å¤šä½™çš„é…ç½®åˆ æ‰äº†ï¼Ÿ âœ…&quot;">â€‹</a></h2><p>æ˜¯çš„ï¼Œå¯ä»¥åˆ æ‰ï¼Œé…ç½®æ•°æ®å·²ç»ä¿å­˜åˆ°æ•°æ®åº“äº†ï¼Œé‡æ–°éƒ¨ç½²ï¼Œä¼šä»æ•°æ®åº“è¯»å–é…ç½®ã€‚åªéœ€ç•™ä¸‹æ•°æ®åº“çš„é…ç½®ã€AUTH_TOKENï¼ˆè¿›å…¥åå°ç”¨ï¼‰å’ŒTZï¼ˆæ—¶åŒºæ–¹ä¾¿çœ‹æ—¥å¿—ï¼‰</p><h2 id="_8-ä¸ºä»€ä¹ˆæˆ‘åœ¨huggingfaceä¸Šä¿®æ”¹ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ-âŒ" tabindex="-1">8. ä¸ºä»€ä¹ˆæˆ‘åœ¨huggingfaceä¸Šä¿®æ”¹ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆï¼Ÿ âŒ <a class="header-anchor" href="#_8-ä¸ºä»€ä¹ˆæˆ‘åœ¨huggingfaceä¸Šä¿®æ”¹ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ-âŒ" aria-label="Permalink to &quot;8. ä¸ºä»€ä¹ˆæˆ‘åœ¨huggingfaceä¸Šä¿®æ”¹ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆï¼Ÿ âŒ&quot;">â€‹</a></h2><p>è‡ªä»å¼•å…¥äº†åœ¨çº¿ä¿®æ”¹é…ç½®é¢æ¿åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥ä¸åœ¨éœ€è¦ä»huggingfaceæ¥ä¿®æ”¹é…ç½®ï¼Œè€Œæ˜¯åœ¨webç«¯å»ä¿®æ”¹é…ç½®ã€‚huggingfaceä¸Šçš„ç¯å¢ƒå˜é‡åªæœ‰åœ¨ç¬¬ä¸€æ¬¡é¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™ç”¨åˆ°ï¼Œé¡¹ç›®å¯åŠ¨æ—¶ä¼šå°†é…ç½®å…¨éƒ¨åŒæ­¥åˆ°æ•°æ®åº“ã€‚é…ç½®ä¼˜å…ˆçº§ æ•°æ®åº“ &gt; huggingfaceç¯å¢ƒå˜é‡</p><h2 id="_9-ä¸ºä»€ä¹ˆæˆ‘è®¿é—®é¡µé¢æ˜¯404-ğŸš«" tabindex="-1">9. ä¸ºä»€ä¹ˆæˆ‘è®¿é—®é¡µé¢æ˜¯404ï¼Ÿ ğŸš« <a class="header-anchor" href="#_9-ä¸ºä»€ä¹ˆæˆ‘è®¿é—®é¡µé¢æ˜¯404-ğŸš«" aria-label="Permalink to &quot;9. ä¸ºä»€ä¹ˆæˆ‘è®¿é—®é¡µé¢æ˜¯404ï¼Ÿ ğŸš«&quot;">â€‹</a></h2><p>å°†spaceä»privateä¿®æ”¹æˆpublicã€‚</p><h2 id="_10-æ€ä¹ˆçœ‹æ›´è¯¦ç»†çš„æ—¥å¿—-ğŸ“„" tabindex="-1">10. æ€ä¹ˆçœ‹æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Ÿ ğŸ“„ <a class="header-anchor" href="#_10-æ€ä¹ˆçœ‹æ›´è¯¦ç»†çš„æ—¥å¿—-ğŸ“„" aria-label="Permalink to &quot;10. æ€ä¹ˆçœ‹æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Ÿ ğŸ“„&quot;">â€‹</a></h2><p>å°†æ—¥å¿—ç­‰çº§æ”¹æˆDEBUGï¼Œåœ¨ä¿å­˜é…ç½®ã€‚ <img src="/assets/image-16.C4EVc3N9.png" alt="alt text"></p><h2 id="_11-ä¸ºä»€ä¹ˆç”»å›¾æœ‰æ—¶å€™ä¸æ˜¾ç¤º-ğŸ¤”" tabindex="-1">11. ä¸ºä»€ä¹ˆç”»å›¾æœ‰æ—¶å€™ä¸æ˜¾ç¤ºï¼Ÿ ğŸ¤” <a class="header-anchor" href="#_11-ä¸ºä»€ä¹ˆç”»å›¾æœ‰æ—¶å€™ä¸æ˜¾ç¤º-ğŸ¤”" aria-label="Permalink to &quot;11. ä¸ºä»€ä¹ˆç”»å›¾æœ‰æ—¶å€™ä¸æ˜¾ç¤ºï¼Ÿ ğŸ¤”&quot;">â€‹</a></h2><p>æœ‰å¯èƒ½æ˜¯è§¦å‘äº†è°·æ­Œçš„å®¡æ ¸ã€‚</p><h2 id="_12-åšæ•°å­¦é¢˜æ—¶-æ—¶é—´å¤ªé•¿å¯¼è‡´æ²¡æœ‰è¾“å‡ºå†…å®¹-â³" tabindex="-1">12. åšæ•°å­¦é¢˜æ—¶ï¼Œæ—¶é—´å¤ªé•¿å¯¼è‡´æ²¡æœ‰è¾“å‡ºå†…å®¹ï¼Ÿ â³ <a class="header-anchor" href="#_12-åšæ•°å­¦é¢˜æ—¶-æ—¶é—´å¤ªé•¿å¯¼è‡´æ²¡æœ‰è¾“å‡ºå†…å®¹-â³" aria-label="Permalink to &quot;12. åšæ•°å­¦é¢˜æ—¶ï¼Œæ—¶é—´å¤ªé•¿å¯¼è‡´æ²¡æœ‰è¾“å‡ºå†…å®¹ï¼Ÿ â³&quot;">â€‹</a></h2><p>ä¿®æ”¹TIME_OUTé…ç½®ï¼Œå°½é‡æ‹‰é•¿è¶…æ—¶æ—¶é—´ã€‚</p><h2 id="_13-gemini-2-5-proä¸ºä»€ä¹ˆä¼šæˆªæ–­-âœ‚ï¸" tabindex="-1">13. gemini-2.5-proä¸ºä»€ä¹ˆä¼šæˆªæ–­ï¼Ÿ âœ‚ï¸ <a class="header-anchor" href="#_13-gemini-2-5-proä¸ºä»€ä¹ˆä¼šæˆªæ–­-âœ‚ï¸" aria-label="Permalink to &quot;13. gemini-2.5-proä¸ºä»€ä¹ˆä¼šæˆªæ–­ï¼Ÿ âœ‚ï¸&quot;">â€‹</a></h2><p>å…è´¹key gemini-2.5-pro ä¸ç¨³å®šï¼Œå°±æ˜¯ä¼šæœ‰æˆªæ–­çš„é—®é¢˜ï¼Œæ®elfmaid ä½¬æµ‹è¯•ï¼Œç”¨å®˜æ–¹çš„openaiæ¥å£å¯ä»¥å‡å°‘è¿™ç§æƒ…å†µï¼Œåç»­æ‰“ç®—ç»´æŠ¤è¿™å¥—æ¥å£ã€‚</p><h2 id="_14-å¦‚ä½•å‡çº§æœåŠ¡" tabindex="-1">14. å¦‚ä½•å‡çº§æœåŠ¡ï¼Ÿ <a class="header-anchor" href="#_14-å¦‚ä½•å‡çº§æœåŠ¡" aria-label="Permalink to &quot;14. å¦‚ä½•å‡çº§æœåŠ¡ï¼Ÿ&quot;">â€‹</a></h2><p>ç‚¹å‡»settings -&gt; fatory rebuild å³å¯ <img src="/assets/image-17.BmK3RCLK.png" alt="alt text"></p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/guide/setup.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>å®‰è£…éƒ¨ç½²</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/guide/acknowledgements.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>ç‰¹åˆ«æ„Ÿè°¢</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"guide_acknowledgements.md\":\"qvMdwLl_\",\"guide_contactme.md\":\"DQ5rL11t\",\"guide_environment.md\":\"BSztEDo3\",\"guide_faq.md\":\"DcpZCSKB\",\"guide_introduction.md\":\"CRoKJ7Jw\",\"guide_setup.md\":\"CCcB8tLv\",\"guide_supportme.md\":\"0HKV5Rm9\",\"index.md\":\"Dm37952a\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Gemini Balance\",\"description\":\"Gemini Balance æŒ‡å—\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"é¦–é¡µ\",\"link\":\"/\"},{\"text\":\"æŒ‡å—\",\"link\":\"/guide/introduction\"}],\"sidebar\":[{\"text\":\"ä½¿ç”¨æŒ‡å—\",\"items\":[{\"text\":\"é¡¹ç›®ä»‹ç»\",\"link\":\"/guide/introduction\"},{\"text\":\"ç¯å¢ƒå˜é‡\",\"link\":\"/guide/environment\"},{\"text\":\"å®‰è£…éƒ¨ç½²\",\"link\":\"/guide/setup\"},{\"text\":\"å¸¸è§é—®é¢˜\",\"link\":\"/guide/faq\"},{\"text\":\"ç‰¹åˆ«æ„Ÿè°¢\",\"link\":\"/guide/acknowledgements\"},{\"text\":\"æ”¯æŒæˆ‘\",\"link\":\"/guide/supportme\"},{\"text\":\"è”ç³»æˆ‘\",\"link\":\"/guide/contactme\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/snailyp/gemini-balance\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>